# NightShiftOS 実装着手順（確定版）

## 1. 目的
`docs/specs/91_実装バックログ.md` を実行順に落とし込み、MVP成立（Phase1完了）までの着手順を固定する。

## 2. 着手順の原則
- クリティカルパスを優先する（Cloud基盤 -> App初期化/Edge送信 -> 通知/Evidence -> E2E試験）。
- 依存がないものは並列実装する。
- Phase2/3項目はPhase1のExit条件達成まで着手しない（例外: 設計下準備のみ）。

## 3. 実装順（Phase1固定）
### Wave 0: 契約固定（最初に完了）
1. `NS-PLT-001` Event Contract v1定義
2. `NS-PLT-002` UUIDv7採番統一
3. `NS-PLT-003` 用語統一ガード導入

### Wave 1: Cloud土台（認証・境界）
1. `NS-CLD-001` DDL初版作成
2. `NS-CLD-002` RLSヘルパーとポリシー実装
3. `NS-CLD-008` profiles/auth bootstrap実装

### Wave 2: Edge/App基盤（並列）
1. Edgeライン
- `NS-EDG-001` BeaconTask実装
- `NS-EDG-002` Radar UARTフレーム解析実装
- `NS-EDG-003` 状態遷移エンジン実装
- `NS-EDG-004` NetworkTask ingest-sensor送信実装
- `NS-EDG-006` Provisioning SoftAP + NVS実装
- `NS-EDG-007` WDT + LEDパターン実装
2. Appライン
- `NS-APP-001` Auth/初期化フロー実装
- `NS-APP-002` 権限ウィザード実装
- `NS-APP-003` Region Monitoring実装
- `NS-APP-004` Enter直後Ranging実装
- `NS-APP-005` Store-and-Forward実装
- `NS-APP-006` Sync Worker実装
- `NS-APP-010` iOS/Androidネイティブ設定反映
3. Cloud連携ライン
- `NS-CLD-003` ingest-sensor実装
- `NS-CLD-004` ingest-movement実装

### Wave 3: 通知・可視化・証跡
1. `NS-CLD-005` notify-staff実装
2. `NS-CLD-006` Realtime publication設定
3. `NS-CLD-007` Evidence SQLとPDF生成実装
4. `NS-APP-007` Critical通知ハンドラ実装

### Wave 4: Phase1品質ゲート
1. `NS-QA-001` Alert Loop E2E試験
2. `NS-QA-002` Auto Check-in E2E試験
3. `NS-QA-003` Offline再送試験
4. `NS-QA-004` RLS侵入試験

## 4. MVP Exit判定
以下4条件をすべて満たした時点でPhase1完了とする。
1. `SITTING/OUT` 通知E2Eが通る。
2. Enter/ExitとCARE記録が同一タイムラインで復元できる。
3. 日次Evidence PDFが出力できる。
4. RLS越境アクセスが0件である。

## 5. Phase2以降（着手保留）
- Phase2: `NS-CLD-009`, `NS-CLD-010`, `NS-APP-008`, `NS-APP-009`, `NS-WEB-001`-`003`, `NS-QA-005`, `NS-QA-006`, `NS-SRE-001`
- Phase3: `NS-WEB-004`, `NS-PLT-005`, `NS-PLT-006`, `NS-EDG-008`, `NS-EDG-009`
